# Roadmap & Pull Request Guide: Next Level IARK Web

This document outlines the findings from the project analysis and proposes a roadmap for the next set of Pull Requests (PRs).

## 1. Dynamic Data Gap Analysis
**Status:** âœ… Mostly Dynamic (Good Job!)
The following sections are already wired to Supabase:
- Stories / Testimonials (`TestimoniSection`)
- Activities / News (`PastActivitiesSection`)
- Management / Pengurus (`ManagementGrid`)
- Events (`EventDetailPage`)

**ðŸš¨ Needs Fix (Hardcoded Data found):**
- **About Section Attributes (`components/features/about/AboutSection.tsx`)**
  - **Issue:** Stats like "500+ Alumni", "23 Chapters", "15+ Tahun" are hardcoded arrays.
  - **Fix:** Create a database function (RPC) or a `stats` table to fetch these counts dynamically.
  - **Benefit:** Numbers update automatically as users grow.

---

## 2. Security Fundamentals (Critical) ðŸ›¡ï¸

### A. Rate Limiting (Missing!)
- **Issue:** There is currently **NO Rate Limiting** visible in the middleware or API routes.
- **Risk:** Vulnerable to DDoS, brute-force attacks on login, and API abuse.
- **Proposed PR:**
  1. Install `@upstash/ratelimit` (or similar).
  2. Implement a rate limiter in `middleware.ts` or a helper function for API routes.
  3. **Strict Limit:** `/auth/*` routes (5 req/min).
  4. **Loose Limit:** Public content (100 req/min).

### B. XSS Prevention (OWASP Top 10)
- **Issue:** Usage of `dangerouslySetInnerHTML` in:
  - `app/dashboard/events/[id]/page.tsx`
  - `app/admin/stories/[id]/page.tsx`
- **Risk:** If an admin account is compromised or a text editor vulnerability exists, malicious scripts can be injected.
- **Proposed PR:**
  - Implement **sanitization** before rendering. Use `isomorphic-dompurify`.
  - Example: `dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(content) }}`.

### C. Authorization (Authz) Check
- **Observation:** `schema.sql` contains good RLS policies (e.g., `Users can update own profile`).
- **Proposed PR:** **Audit RLS Policies**. Ensure "Service Role" key is NEVER used in the client. Verify that `public` role cannot access sensitive fields (e.g., user emails in `profiles` should perhaps be private or obscured if not necessary).

---

## 3. Performance + Simplicity Instinct ðŸš€

### A. Client-Side Fetching vs. Server Components (Major Win)
- **Issue:** Key landing page sections (`TestimoniSection`, `PastActivitiesSection`, `ManagementGrid`) are marked `'use client'` and use `useEffect` to fetch data.
- **Problem:**
  - **Performance:** Browser waits for JS to load -> executes JS -> fetches data -> renders. Slower LCP (Largest Contentful Paint).
  - **SEO:** Search engines (googlebot) might miss content rendered via `useEffect`.
  - **UX:** Layout shifts with loading skeletons everywhere.
- **Proposed PR:**
  - **Refactor to Server Components:**
    Move the `supabase.from(...).select(...)` logic into top-level `async function` components.
    Pass data as props to Client Components only for interactivity (like Sliders).

### B. Caching Strategy
- **Issue:** Current `useEffect` fetching hits the DB on **every single page load** for every user.
- **Fix:** Next.js `unstable_cache` or `fetch` caching.
  - Cache "Static" content (Stories, Management) for 1 hour or 1 day.
  - Revalidate on Admin updates.
- **Benefit:** Instant page loads, zero DB load for public traffic.

### C. N+1 Problem Prevention
- **Observation:** `TestimoniSection` uses `.select('*, profiles:author_id(...)')`.
- **Verdict:** âœ… **Good!** This is the correct way to avoid N+1 queries in Supabase (Postgres). Keep doing this (Joins overloops).

---

## 4. Suggested Implementation Plan (The "PRs")

### ðŸ“¦ PR #1: Security Hardening
1. Add Rate Limiting (`middleware.ts`).
2. Add sanitization for `dangerouslySetInnerHTML`.

### ðŸš€ PR #2: Performance / Server Components
1. Convert `TestimoniSection` to Server Component.
2. Convert `PastActivitiesSection` to Server Component.
3. Convert `ManagementGrid` to Server Component.
4. Implement `unstable_cache` for these fetches.

### ðŸ”¢ PR #3: Dynamic Stats
1. Replace `AboutSection` hardcoded stats with dynamic DB counts (using a simple Postgres function `get_dashboard_stats`).

---

*Generated by Antigravity Analysis - 2026-02-04*
